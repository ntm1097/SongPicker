<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="/Assets/favicon.ico" type="image/x-icon" />
    <title>Clear Praise</title>
    <!-- Add these script tags before your index.js script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  </head>
  <body id="home">
    <div id="home" class="container">
      <div class="use__record">
        <div class="most__used">
          <span class="record__title">Most Picked</span>
          <li class="number__order">1.</li>
          <li class="number__order">2.</li>
          <li class="number__order">3.</li>
          <li class="number__order">4.</li>
          <li class="number__order">5.</li>
          <li class="number__order">6.</li>
          <li class="number__order">7.</li>
          <li class="number__order">8.</li>
          <li class="number__order">9.</li>
          <li class="number__order">10.</li>
        </div>
        <div class="least__picked">
          <span class="record__title">Least Picked</span>
          <li class="number__order">1.</li>
          <li class="number__order">2.</li>
          <li class="number__order">3.</li>
          <li class="number__order">4.</li>
          <li class="number__order">5.</li>
          <li class="number__order">6.</li>
          <li class="number__order">7.</li>
          <li class="number__order">8.</li>
          <li class="number__order">9.</li>
          <li class="number__order">10.</li>
        </div>
      </div>
    </div>
  </body>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBOX7iUIR-GDnfpY0wQ_oOegJUYOJTM9LE",
      authDomain: "hpbc-songpicker.firebaseapp.com",
      databaseURL: "https://hpbc-songpicker-default-rtdb.firebaseio.com",
      projectId: "hpbc-songpicker",
      storageBucket: "hpbc-songpicker.firebasestorage.app",
      messagingSenderId: "677978452426",
      appId: "1:677978452426:web:b81f46a94cfe0380295f33",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function getSongUsageStatistics() {
      try {
        // Define Christmas songs to exclude
        const christmasSongs = [
          "angels we have heard on high",
          "away in a manger",
          "emmanuel hallowed ground",
          "joy to the world",
          "angels from the realms of glory",
          "go tell it on the mountain",
          "he shall reign forevermore",
          "o come o come emmanuel",
          "o come all ye faithful",
        ];

        // Get all songs from the database with their existing counts
        const songsSnapshot = await db.collection("songs").get();
        const allSongs = [];

        songsSnapshot.docs.forEach((doc) => {
          const songData = doc.data();
          const songName = songData.name || doc.id;
          const count = songData.count || 0; // Use the existing count field

          // Exclude Christmas songs from statistics
          if (!christmasSongs.includes(songName.toLowerCase().trim())) {
            allSongs.push({
              name: songName,
              count: count,
            });
          }
        });

        console.log("Songs with counts (excluding Christmas songs):", allSongs);

        // Sort by count (ascending for least picked, descending for most picked)
        const leastPicked = [...allSongs]
          .sort((a, b) => a.count - b.count)
          .slice(0, 10);

        const mostPicked = [...allSongs]
          .sort((a, b) => b.count - a.count)
          .slice(0, 10);

        return { mostPicked, leastPicked };
      } catch (error) {
        console.error("Error fetching song statistics:", error);
        return { mostPicked: [], leastPicked: [] };
      }
    }

    function populateSongLists(mostPicked, leastPicked) {
      // Populate most picked list
      const mostPickedElements = document.querySelectorAll(
        ".most__used .number__order"
      );
      mostPickedElements.forEach((element, index) => {
        if (index < mostPicked.length) {
          element.textContent = `${index + 1}. ${mostPicked[index].name} (${
            mostPicked[index].count
          })`;
        } else {
          element.textContent = `${index + 1}.`;
        }
      });

      // Populate least picked list
      const leastPickedElements = document.querySelectorAll(
        ".least__picked .number__order"
      );
      leastPickedElements.forEach((element, index) => {
        if (index < leastPicked.length) {
          const countText =
            leastPicked[index].count === 0
              ? "Never used"
              : `${leastPicked[index].count}`;
          element.textContent = `${index + 1}. ${
            leastPicked[index].name
          } (${countText})`;
        } else {
          element.textContent = `${index + 1}.`;
        }
      });
    }

    // Load statistics when page loads
    document.addEventListener("DOMContentLoaded", async function () {
      try {
        const { mostPicked, leastPicked } = await getSongUsageStatistics();
        populateSongLists(mostPicked, leastPicked);
      } catch (error) {
        console.error("Error loading song statistics:", error);
      }
    });
  </script>
  <script src="index.js"></script>
</html>
